<div class="min-h-screen bg-gray-100 p-8">
  <div
    class="mb-10 px-6 py-2 border-l-4 border-r-4 border-blue-900 border-t border-b border-blue-200 rounded-lg text-center"
  >
    <h4 class="text-3xl font-bold text-gray-900 tracking-tight">
      Student Course Unfinalize
    </h4>
    <p class="text-sm text-gray-600 mt-1">
      Unfinalize student course registration
    </p>
  </div>

  <div class="bg-white border border-gray-300 p-6 mb-10 rounded-lg">
    <div
      class="px-4 py-2 bg-blue-100 border-l-4 border-blue-900 mb-6 rounded-md"
    >
      <h5 class="text-lg font-semibold text-blue-900">
        Unfinalize Student Registration
      </h5>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <div>
        <label class="text-sm font-medium text-gray-700"
          >Academic Session *</label
        >
        <select
          class="mt-1 w-full border border-gray-300 rounded-md p-0.5 text-sm"
          [(ngModel)]="selectedAcademicSession"
        >
          <option value="">Select Academic Session</option>
          <option
            *ngFor="let session of academicSession"
            [value]="session.academic_session_id"
          >
            {{ session.academic_session_name_e }}
          </option>
        </select>
      </div>
      <div>
        <label class="text-sm font-medium text-gray-700"
          >Degree Programme Type*</label
        >
        <select
          class="mt-1 w-full border border-gray-300 rounded-md p-0.5 text-sm"
          [(ngModel)]="selectedDegreeProgramTypeList"
          (ngModelChange)="onDegreeProgramTypeChange()"
        >
          <option value="">Select Degree Type</option>
          <option
            *ngFor="let t of degreeProgramTypeList"
            [value]="t.degree_programme_type_id"
          >
            {{ t.degree_programme_type_name_e }}
          </option>
        </select>
      </div>
      <div>
        <label class="text-sm font-medium text-gray-700"
          >Degree Programme *</label
        >
        <select
          class="mt-1 w-full border border-gray-300 rounded-md p-0.5 text-sm"
          [(ngModel)]="selectedDegreeProgram"
        >
          <option value="">Select Degree Programme</option>
          <option
            *ngFor="let d of degreeProgramList"
            [value]="d.degree_programme_id"
          >
            {{ d.degree_programme_name_e }}
          </option>
        </select>
      </div>
      <div>
        <label class="text-sm font-medium text-gray-700">College *</label>
        <select
          class="mt-1 w-full border border-gray-300 rounded-md p-0.5 text-sm"
          [(ngModel)]="selectedCollege"
        >
          <option value="">Select College</option>
          <option *ngFor="let c of collegeList" [value]="c.college_id">
            {{ c.college_name_e }}
          </option>
        </select>
      </div>
      <div>
        <label class="text-sm font-medium text-gray-700">Course Year *</label>
        <select
          class="mt-1 w-full border border-gray-300 rounded-md p-0.5 text-sm"
          [(ngModel)]="selectedCourseYear"
        >
          <option value="">Select Course Year</option>
          <option *ngFor="let y of courseYearList" [value]="y.course_year_id">
            {{ y.course_year_name_e }}
          </option>
        </select>
      </div>
      <div>
        <label class="text-sm font-medium text-gray-700">Semester *</label>
        <select
          class="mt-1 w-full border border-gray-300 rounded-md p-0.5 text-sm"
          [(ngModel)]="selectedSemester"
        >
          <option value="">Select Semester</option>
          <option *ngFor="let s of semesterList" [value]="s.semester_id">
            {{ s.semester_name_e }}
          </option>
        </select>
      </div>
    </div>

    <div class="mt-8 flex justify-center gap-4">
      <button
        class="px-8 py-2 bg-blue-900 text-white text-sm font-semibold !rounded-md shadow hover:bg-blue-700 transition"
        (click)="getStudentList()"
      >
        Search
      </button>
      <button
        class="px-8 py-2 bg-green-600 text-white text-sm font-semibold !rounded-md shadow hover:bg-green-500 transition flex items-center gap-2"
        (click)="resetFilters()"
      >
        Reset
      </button>
    </div>
  </div>

  <div class="bg-white border border-gray-300 p-6 mb-10 rounded-lg">
    <div
      class="px-4 py-2 bg-blue-100 border-l-4 border-blue-900 mb-6 rounded-md flex flex-col md:flex-row justify-between items-center gap-4"
    >
      <h5 class="text-lg font-semibold text-blue-900">
        Student Registration List
      </h5>

      <div class="relative w-full md:w-1/3">
        <input
          type="text"
          placeholder="Search UE ID, Name, Reg ID"
          class="w-full border bg-white border-gray-600 rounded-md pl-8 pr-4 py-1.5 text-sm focus:ring-2 focus:ring-blue-900 outline-none transition"
          [(ngModel)]="searchText"
          (input)="filterTable()"
        />
        <svg
          class="absolute left-2.5 top-2 w-4 h-4 text-gray-500"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </div>
    </div>

    <div class="overflow-x-auto">
      <div
        class="flex flex-col md:flex-row justify-between items-center mb-4 gap-3"
      >
        <div class="flex items-center gap-2 text-sm">
          <label class="font-medium text-gray-700">Rows per page:</label>
          <select
            class="border border-gray-300 rounded px-2 py-1 text-sm outline-none"
            [(ngModel)]="pageSize"
            (change)="onPageSizeChange()"
          >
            <option *ngFor="let size of pageSizeOptions" [ngValue]="size">
              {{ size }}
            </option>
          </select>
        </div>

        <div class="flex items-center gap-2 text-sm">
          <span class="text-gray-600 mr-2"
            >Total Records: <strong>{{ filteredStudentList.length }}</strong></span
          >
          <button
            class="px-3 py-1 border rounded hover:bg-gray-50 disabled:opacity-50"
            [disabled]="currentPage === 1"
            (click)="prevPage()"
          >
            Prev
          </button>
          <span class="font-semibold mx-2"
            >{{ currentPage }} / {{ totalPages }}</span
          >
          <button
            class="px-3 py-1 border rounded hover:bg-gray-50 disabled:opacity-50"
            [disabled]="currentPage === totalPages"
            (click)="nextPage()"
          >
            Next
          </button>
        </div>
      </div>

      <table
        class="w-full text-sm border border-gray-300 rounded-lg overflow-hidden"
      >
        <thead>
          <tr class="bg-blue-900 text-white font-semibold text-sm">
            <th class="border px-3 py-2 text-center">S.No.</th>
            <th class="border px-3 py-2 text-left">UE Id</th>
            <th class="border px-3 py-2 text-left">Registration Id</th>
            <th class="border px-3 py-2 text-left">Student Name</th>
            <th class="border px-3 py-2 text-left">Course Year</th>
            <th class="border px-3 py-2 text-left">Semester</th>
            <th class="border px-3 py-2 text-left">Finalize Status</th>
            <th class="border px-3 py-2 text-left">Remark</th>
            <th class="border px-3 py-2 text-center">Action</th>
          </tr>
        </thead>

        <tbody class="text-gray-800">
          <tr
            *ngFor="let student of paginatedStudentList; let i = index"
            class="hover:bg-blue-100 transition"
          >
            <td class="border px-3 py-2 text-center font-semibold">
              {{ (currentPage - 1) * pageSize + i + 1 }}
            </td>
            <td class="border px-3 py-2">{{ student.ue_id }}</td>
            <td class="border px-3 py-2">{{ student.registration_id }}</td>
            <td class="border px-3 py-2 font-medium">
              {{ student.student_name }}
            </td>
            <td class="border px-3 py-2">{{ student.course_year_name_e }}</td>
            <td class="border px-3 py-2">{{ student.semester_name_e }}</td>

            <td class="border px-3 py-2 text-center">
              <span
                *ngIf="student.is_finalize_yn === 'Y'"
                class="px-2 py-1 text-xs font-semibold rounded bg-green-100 text-green-800 border border-green-300"
                >Finalized</span
              >
              <span
                *ngIf="student.is_finalize_yn !== 'Y'"
                class="px-2 py-1 text-xs font-semibold rounded bg-yellow-100 text-yellow-800 border border-yellow-300"
                >Not Finalized</span
              >
            </td>

            <td class="border px-3 py-2">
              <input
                *ngIf="student.is_finalize_yn === 'Y'"
                type="text"
                class="w-full border border-gray-300 bg-white rounded px-2 py-1 text-xs focus:ring-1 focus:ring-blue-900 outline-none"
                placeholder="Enter reason"
                [(ngModel)]="student.action_remark"
              />
              <span
                *ngIf="student.is_finalize_yn !== 'Y'"
                class="text-xs text-gray-700 font-medium"
                >{{ student.unfinalize_remark || "-" }}</span
              >
            </td>

            <td class="border px-3 py-2 text-center">
              <button
                *ngIf="student.is_finalize_yn === 'Y'"
                class="px-4 py-1 bg-red-600 text-white text-xs font-semibold !rounded-md shadow hover:bg-red-700 transition"
                (click)="unfinalizeStudent(student)"
              >
                UnFinalize
              </button>
              <span
                *ngIf="student.is_finalize_yn !== 'Y'"
                class="text-xs text-gray-500"
                >-</span
              >
            </td>
          </tr>

          <tr *ngIf="filteredStudentList.length === 0">
            <td colspan="9" class="text-center py-4 text-gray-500">
              No student records found
            </td>
          </tr>
        </tbody>
      </table>
      <div class="flex justify-end w-full">
        <div class="flex items-center gap-2 text-sm">
          <span class="text-gray-600 mr-2">
            Total Records:
            <strong>{{ filteredStudentList.length }}</strong>
          </span>

          <button
            class="px-3 py-1 border rounded hover:bg-gray-50 disabled:opacity-50"
            [disabled]="currentPage === 1"
            (click)="prevPage()"
          >
            Prev
          </button>

          <span class="font-semibold mx-2">
            {{ currentPage }} / {{ totalPages }}
          </span>

          <button
            class="px-3 py-1 border rounded hover:bg-gray-50 disabled:opacity-50"
            [disabled]="currentPage === totalPages"
            (click)="nextPage()"
          >
            Next
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
