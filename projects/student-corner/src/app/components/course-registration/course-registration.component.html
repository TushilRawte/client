<section class="container-fluid">
  <form [formGroup]="courseRegistrationForm">
    <!-- <div class="header">
    <h2>Course Registration</h2>
  </div> -->

    <mat-card class="basic-details-card">
      <mat-card-content>
        <div class="card-header-custom">
          <mat-card-title>Basic Details</mat-card-title>
        </div>
        <div>
          <div class="row">
              <div class="col-md-4 col-6">
              <div class="detail-item">
                <label class="detail-label">UE ID:</label>
                <div class="detail-value">{{ studentData?.ue_id }}</div>
              </div>
            </div>
            <div class="col-md-4 col-6">
              <div class="detail-item">
                <label class="detail-label">Dean Committee & Session:</label>
                <div class="detail-value">{{ studentData?.dean_committee_name_e }} , {{ studentData?.academic_session_name_e}}</div>
              </div>
            </div>
            <div class="col-md-4 col-6">
              <div class="detail-item">
                <label class="detail-label">Year & Semester:</label>
                <div class="detail-value">{{ studentData?.course_year_name_e}} , {{ studentData?.semester_name_e }}</div>
              </div>
            </div>
            <div class="col-md-4 col-6">
              <div class="detail-item">
                <label class="detail-label">Academic Standing & Study Status:</label>
                <div class="detail-value">{{studentData?.stu_acad_status_name_e}} , {{studentData?.stu_study_status_name_e}}</div>
              </div>

            </div>
            <div class="col-md-4 col-6">
              <div class="detail-item">
                <label class="detail-label">College:</label>
                <div class="detail-value">{{ studentData?.college_name_e }}</div>
              </div>

            </div>
            <div class="col-md-4 col-6">

              <div class="detail-item">
                <label class="detail-label">Degree Programme:</label>
                <div class="detail-value">{{ studentData?.degree_programme_name_e }}</div>
              </div>
            </div>
          </div>

        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="mt-3">
      <mat-card-content>

        <div class="course-list">

          <div class="col-md-12 section">
            <h5> <strong>Courses</strong> </h5>

            <div class="table-responsive">
              <table class="table table-bordered">
                <thead class="table-header">
                  <tr>
                    <th>#</th>
                    <th>Course Title</th>
                    <th>Teachers</th>
                    <th>Type</th>
                    <th>Credit</th>
                    <th>C/O</th>
                    <th>Remove</th>
                  </tr>
                </thead>
                <tbody id="selectedCoursesTable">
                  <tr *ngFor="let course of selectedCourses; let i = index"
                    [class.highlighted-row]="!isFailedCourse(course)"
                    [class.failed-course-row]="isFailedCourse(course)">

                    <td>{{ i + 1 }}</td>
                    <td>{{ course?.course_name }}</td>
                    <td>{{course?.teacher_name}}</td>
                    <td>{{ course?.course_type_name_e }}</td>
                    <td>{{ course?.credit}}</td>
                    <td> {{ course?.cou_allot_type_name_e === 'Complusory' ? 'C' : (course?.cou_allot_type_name_e ===
                      'Optional' ? 'O' : '') }}</td>
                    <td>
                      <button type="button" color="danger" class="btn-remove"
                        [class.failed-course-remove]="isFailedCourse(course)"
                        [disabled]="isFailedCourse(course)  || course.cou_allot_type_name_e === 'Complusory'"
                        (click)="onCourseRemove(course.course_id,course.course_nature_id)"
                        [title]="isFailedCourse(course) ? 'Failed courses are mandatory and cannot be removed' : 'Remove Course'">
                        <mat-icon>{{ isFailedCourse(course) ? 'lock' : 'close' }}</mat-icon>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="course-legend mt-3">
              <ul style="list-style: none; padding: 0; margin: 0;">

                <li class="legend-item d-flex align-items-center">
                  <span class="legend-color normal-course mr-2"></span>
                  Normal Courses
                </li>

                <li class="legend-item d-flex align-items-center mt-2">
                  <span class="legend-color failed-course mr-2"></span>
                  Failed Courses (Auto-selected)
                </li>

              </ul>
            </div>



          </div>

          <div *ngIf="otherCourseFromAllotment.length > 0">
            <div class="col-6 mt-5">
              <h5> <strong>Add More Courses</strong></h5>
            </div>

            <div class="row">

              <div class="col-md-6 col-8">
                <ng-select #courseSelect [items]="otherCourseFromAllotment" bindLabel="course_name" appearance="outline"
                  (change)="onCourseSelect($event)">
                </ng-select>
              </div>

              <div class="col-md-2 col-2" *ngIf="onSelectDropCourse">
                <button (click)="onCourseAdd(courseSelect)" mat-raised-button color="primary" type="button">Add</button>
              </div>
            </div>
          </div>





          <hr />
          <!-- <div class="row">

          <div class="col-md-12 section">
            <div>
              <h5>Major Courses (optional)</h5>

              <table class="table table-bordered">
                <thead class="table-header">
                  <tr>
                    <th>#</th>
                    <th>Course Title</th>
                    <th>Teachers</th>
                    <th>Type</th>
                    <th>Nature</th>
                    <th>C/O</th>
                    <th>Add</th>
                  </tr>
                </thead>
                <tbody id="availableCoursesTable">
                  <tr *ngFor="let course of courseFromAllotment; let i = index">
                    <td>{{ i + 1 }}</td>
                    <td>{{ course.course_name }}</td>
                    <td></td>
                    <td>{{ course.course_type_name_e }}</td>
                    <td>{{ course.course_nature_name_e}}</td>
                    <td></td>
                    <td>
                      <button type="button" color="primary" class=" btn-add" (click)="selectCourse(course)">
                        <mat-icon>add</mat-icon>
                      </button>

                    </td>
                  </tr>

                </tbody>
              </table>
            </div>
          </div>
          

          </div> -->

        </div>
        <div class="col-sm-3">
          @if (studentData?.registration_status_id == 2) {
          <button type="button" (click)="onSubmit()" class="btn btn-primary">Register courses</button>
          } @else {
          <button type="button" (click)="onUpdate()" class="btn btn-primary">Update courses</button>
          }
        </div>

      </mat-card-content>
    </mat-card>


  </form>
</section>